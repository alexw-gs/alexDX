window.Coveo=window.Coveo||{};var c4sf=function(o){var n={};function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}return r.m=o,r.c=n,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=151)}({1:function(e,t){e.exports=$},151:function(e,t,o){"use strict";o.r(t),o.d(t,"HealthCheckPanel",function(){return k});var n,r,i=o(1);(r=n=n||{})[r.Working=0]="Working",r[r.NotWorking=1]="NotWorking",r[r.UnknownIssue=2]="UnknownIssue";var s=(a.prototype.getClassname=function(){var e;switch(this.state){case n.NotWorking:e="not-working";break;case n.Working:e="working";break;case n.UnknownIssue:e="unknown-issue"}return e},a);function a(e,t,o,n,r,i){if(null==e||0===e.length)throw new Error("The title is invalid");if(null==o||0===o.length)throw new Error("The description is invalid");if(null==t)throw new Error("Invalid state");this.toolTip=n,this.helpDocLabel=r,this.helpDocLink=i,this.title=e,this.state=t,this.description=o}function c(e,t){var o;if($(e).hasClass(t))o=$(e);else{if(1!==$(e).find("."+t).get().length)throw Error("root element is invalid");o=$(e).find("."+t)}return o}function l(e){var t=new Error;return t.message=e.message?e.message:"",t.stack=e.where?e.where:null,t}var d=(Object.defineProperty(h.prototype,"error",{set:function(e){var t=i('\n    <div class="blankslate m2 mod-danger coveo-critical-error">\n      <div class="coveo-error-header">\n        <div class="coveo-error-icon"></div>\n        <div class="coveo-error-message"><span>'+e+"</span></div>\n      </div>\n    </div>");i(this.root).find(this._checks).replaceWith(t),this._checks=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"visible",{set:function(e){(this._visible=e)?this.root.show():this.root.hide()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"loading",{set:function(e){e?this.showLoading():this.hideLoading()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"contextBox",{set:function(e){var t=i('<div class="coveo-hc-context-panel">').append(e);i(this.root).find(this._contextBox).replaceWith(t),this._contextBox=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"checks",{set:function(e){this.loading=!1;var t=this.buildTable(e);i(this.root).find(this._checks).replaceWith(t),this.root.find(".coveo-hc-overlay-dark").remove(),this._checks=t},enumerable:!0,configurable:!0}),h.prototype.toggle=function(){this.root.toggle(),this._visible=!this._visible},h.prototype.showLoading=function(){i(this._loading).show()},h.prototype.hideLoading=function(){i(this._loading).hide()},h.prototype.buildTitle=function(e){var t=document.createElement("div");return i(t).addClass("coveo-hc-title").text(e),t},h.prototype.buildTable=function(e){return null==e||0===e.length?i("<div>").hide():i('<table class="coveo-hc-table"/>').append(this.buildTableRows(e)).prepend("<thead><tr><th>Service</th><th>Status</th><th>Help</th></tr></thead>")},h.prototype.buildTableRows=function(e){var o=this;return e.map(function(e){var t="<a "+(e.helpDocLink?'href="'+e.helpDocLink+'"':"")+' target="_blank">'+(e.helpDocLabel?e.helpDocLabel:"")+"</a>";return i('<tr class="'+e.getClassname()+'"></tr>').append("<td>"+e.title+(null!=o.icons?'<img src="'+o.icons.help+'" title="'+e.toolTip+'" data-placement="right"/>':"")+'</td><td><div class="'+e.getClassname()+'"></div>'+e.description.replace(/\n/g,"").trim()+"</td><td>"+(e.helpDocLink||e.helpDocLabel?t:"")+"</td>")})},h);function h(e,t,o,n,r){this.root=c(e,"coveo-hc-subpanel"),this.icons=r,i(this.root).append(this.buildTitle(t),i("<div>").addClass("coveo-hc-context-panel").append(n),this.buildTable(o),u),this._contextBox=i(this.root).children(":nth-child(2)"),this._checks=i(this.root).children(":nth-child(3)"),this._loading=i(this.root).children(":nth-child(4)")}var u='<div class="spinner mod-vertical-margin" style="display:none;"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>',p="coveo-close-button",v="coveo-advanced-details-button",f='<div class="coveo-hc-subpanel">',g='\n<div class="blankslate m2 mod-danger coveo-critical-error" style="display:none;">\n  <div class="coveo-error-header">\n    <div class="coveo-error-icon"></div>\n    <div class="coveo-error-message">\n      <span>An unexpected error has occurred.</span><br>\n      <span>If the error persists, contact Coveo Support.</span><br>\n      <span>To know the current status of the Coveo Cloud services, see <a href="http://status.cloud.coveo.com/">Coveo System Status</a>.</span>\n    </div>\n  </div>\n  <div class="coveo-error-detail"><pre></pre></div>\n</div>',b='\n  <div>\n    <div>Search Token Payload</div>\n    <div class="coveo-search-token"><pre></pre></div>\n    <div>Raw JSON Response</div>\n    <div class="coveo-health-check-token"><pre></pre></div>\n  </div>',k=(y.prototype.getSearchToken=function(){var t=this;this.context.getSearchToken(function(e){try{t.lastSearchToken=t.parseJWT(e)}catch(e){t.renderError("An error occurred while getting the search token information.",e)}finally{t.update()}})},y.prototype.load=function(){this.header=i('\n  <div class="coveo-hc-header">\n    <h1>\n      <div class="coveo-close-button">Close  <span class="coveo-hc-close-x">X</span></div>\n    </h1>\n  </div>'),this.orgDetailPanel=new d(i(f).addClass("coveo-org-details"),"Organization Details",[],this.buildOrgDetails(null),this.context.icons),this.userTestsPanel=new d(i(f).addClass("coveo-search-token-details"),"Search Token Details",[],i('\n  <div class="coveo-hc-runner input-field form-group">\n    <div class="label">Search token</div>\n    <input class="coveo-hc-input" type="text" placeholder="Enter your search token"></input>\n    <button class="btn spaced-box coveo-run-hc">Run health check</button>\n  </div>'),this.context.icons),this.searchTokenPanel=new d(i(f).addClass("coveo-advance-details"),"Advanced Details",[],i(b)),i(this.root).append(this.header,this.orgDetailPanel.root,this.userTestsPanel.root,'<button class="btn spaced-box coveo-advanced-details-button">Advanced Details</div>',this.searchTokenPanel.root),this.searchTokenPanel.visible=!1,this.addHandlers()},y.prototype.reset=function(){this.userTestsPanel.checks=[]},y.prototype.update=function(e,t,o){this.orgDetailPanel.loading=!1,this.userTestsPanel.loading=!1,null!=o&&(this.orgDetailPanel.contextBox=this.buildOrgDetails(o)),null!=t&&(this.orgDetailPanel.checks=t),null!=e&&(this.userTestsPanel.checks=e),this.searchTokenPanel.contextBox=this.buildAdvancePanel(this.lastSearchToken,this.lastHealthCheckToken)},y.prototype.addHandlers=function(){var o=this;i(this.root).find(".coveo-hc-runner .coveo-run-hc").on("click",function(e){var t=i(o.root).find(".coveo-hc-runner .coveo-hc-input").val();o.reset();try{if(null==t||""===t){o.userTestsPanel.loading=!0;try{o.context.getHealthCheck(o.updater)}catch(e){o.renderCriticalError(e)}}else o.lastSearchToken=o.parseJWT(t),o.userTestsPanel.loading=!0,o.context.runHealthCheck(o.updater,t)}catch(e){o.renderError("The Search Token is invalid.",e)}}),i(this.root).find("."+p).click(function(){i(o.root).hide()}),i(this.root).find("."+v).click(function(){o.searchTokenPanel.toggle()})},y.prototype.hideLoadingAnimation=function(){i(this.root).find(".loading-prompt").hide()},y.prototype.buildAdvancePanel=function(e,t){var o=b.split("<pre></pre>",3);return i(o[0]+this.wrap(e,"pre")+o[1]+this.wrap(t,"pre")+o[2])},y.prototype.buildOrgDetails=function(e){return i('\n      <div class="coveo-hc-coveo-organization-field">Coveo Organization : '+(null==e?"":e.coveoOrg)+'</div>\n      <div class="coveo-hc-salesforce-organization-field">Salesforce Organization : '+(null==e?"":e.salesforceOrg)+'</div>\n      <div class="coveo-hc-sandbox-field">Sandbox : '+(null==e?"":e.sandbox?"Yes":"No")+"</div>\n    ")},y.prototype.parse=function(e,t){try{t(this.parseResponse(e))}catch(e){this.renderError("An error occurred while parsing the response.",e)}},y.prototype.parseResponse=function(e){var t,o,n;if(!(e&&e.coveoOrganization&&e.salesforceOrganization&&e.user))throw Error("Invalid response");var r={organization:{details:{coveoOrg:e.coveoOrganization.id,salesforceOrg:e.salesforceOrganization.id,sandbox:e.salesforceOrganization.sandbox},tests:new Array},user:{tests:new Array}};return(t=r.organization.tests).push.apply(t,e.coveoOrganization.tests.map(this.parseResponseTest)),(o=r.organization.tests).push.apply(o,e.salesforceOrganization.tests.map(this.parseResponseTest)),(n=r.user.tests).push.apply(n,e.user.tests.map(this.parseResponseTest)),r},y.prototype.parseResponseTest=function(e){var t=null==e.url?null:e.url.label,o=null==e.url?null:e.url.httpUrl;return new s(e.name,e.result.statusCode,e.result.details,e.tooltip,t,o)},y.prototype.wrap=function(e,t){return"<"+t+">"+e+"</"+t+">"},y.prototype.renderCriticalError=function(e){this.root.children().hide(),this.errorMessage.find("pre").text(this.toJsonString(e)),this.errorMessage.show()},y.prototype.toJsonString=function(e){return JSON.stringify(e,null,4)},y.prototype.parseJWT=function(e){return this.toJsonString(JSON.parse(atob(e.split(".")[1])))},y.prototype.renderError=function(e,t){this.lastSearchToken="",this.lastHealthCheckToken="",this.userTestsPanel.error=e+(t?"\n\n"+t.message:""),this.update()},y);function y(e,t){var o=this;this.builder=function(e,t){if(t&&t.status)o.lastHealthCheckToken=JSON.stringify(e,null,4),o.load(),o.hideLoadingAnimation(),o.parse(e,function(e){o.update(e.user.tests,e.organization.tests,e.organization.details),o.getSearchToken()});else try{o.renderCriticalError(JSON.parse(l(t).message))}catch(e){o.renderCriticalError(t)}},this.updater=function(e,t){t&&t.status?(o.lastHealthCheckToken=JSON.stringify(e,null,4),o.userTestsPanel.loading=!1,o.parse(e,function(e){o.update(e.user.tests),o.getSearchToken()})):t.message?o.renderError("The response is invalid.",l(t)):o.renderError("The response is invalid.")},this.root=c(e,"coveo-health-check-panel"),this.context=t,this.errorMessage=function(){if(o.context.icons&&o.context.icons.error){var e=i(g);return e.find(".coveo-critical-error .coveo-error-icon").prepend('<img src="'+o.context.icons.error+'">'),e}return i(g)}(),i(this.root).append(this.errorMessage,'\n  <div class="loading-prompt">\n    <div>Performing health check...</div>\n    <div class="spinner">\n      <div class="bounce1"></div>\n      <div class="bounce2"></div>\n      <div class="bounce3"></div>\n    </div>\n  </div>');try{this.context.getHealthCheck(this.builder)}catch(e){this.renderCriticalError(e)}}}});!function(e,t){for(var o in t)e[o]=t[o]}(window.Coveo,c4sf);